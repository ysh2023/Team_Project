<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board.model.Board">
	<select id="GetAllBoard" resultType="board.model.BoardBean">
	select * from board
		<choose>
			<when test="categoryType=='0'">
				  <if test="category!='All'">where category like #{category}</if>
			order by bod_num
			</when>
			<when test="categoryType=='1'">
				where bod_num in(select bod_num from boardIngredient where ing_num in(select ing_num from ingredient where ing_category = #{category}))
			</when>
		</choose>
	</select>
	<insert id="InsertBoard">insert into board values(bod_seq.nextval, #{title},
		#{servings}, #{time}, #{category}, #{tags}, #{id}, #{bodImage})</insert>
	<insert id="InsertBoardContent">insert into boardcontent values(bcn_seq.nextval,
		#{image}, #{bodContent}, bod_seq.currval)</insert>
	<insert id="InsertBoardIngredient">insert into boardingredient values(big_seq.nextval,
		 bod_seq.currval, #{bigName})</insert>
	<select id="GetTopBoard" resultType="board.model.BoardBean">
		select board.bod_num, title, servings, time, category, tags, id, bod_image from board inner join (select count(*)cnt, bod_num  from recommend group by bod_num order by cnt desc) sel on board.bod_num = sel.bod_num
	</select>
	<select id="GetBoardByBodNum" resultType="board.model.BoardBean">select * from board where bod_num = #{bodNum}</select>
	<select id="GetBoardContentByBodNum" resultType="board.model.BoardContentBean">select * from boardcontent where bod_num = #{bod_num}</select>
	<select id="GetAllIngredient" resultType="ingredient.model.IngBean">select * from ingredient order by ing_num</select>
	<select id="GetCommentByBodNum" resultType="board.model.CommentsBean">select * from comments where bod_num = #{bodNum} order by ref desc, ref_level asc, ref_step asc</select>
	<select id="GetIngredientCategory" resultType="String">select distinct ing_category from ingredient</select>
	<select id="GetBoardIngredientByBodNum" resultType="board.model.BoardIngredientBean">select * from boardIngredient where bod_num=#{bodNum}</select>
	<delete id="DeleteBoardByBodNum">delete from board where bod_num = #{bodNum}</delete>
</mapper>