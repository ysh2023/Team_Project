<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="recipe.model.RecipeBean">
  	<select id="GetAllRecipe" resultType="recipe.model.RecipeBean">
  		select * from recipe
  		<if test="whatColumn == 'recipename'">
  			where recipe_name like #{keyword}
  		</if>
  		<if test="whatColumn == 'recipecategory'">
  			where recipe_category like #{keyword}
  		</if>
  		order by recipe_num
  	</select>
  	
  	<select id="GetTotalCount" resultType="int">
  		select count(*) from recipe
  		<if test="whatColumn == 'recipename'">
  			where recipe_name like #{keyword}
  		</if>
  		<if test="whatColumn == 'recipecategory'">
  			where recipe_category like #{keyword}
  		</if>
  	</select>
  	<select id="GetRecipe" resultType="recipe.model.RecipeBean">
  		select * from recipe
  		where recipe_num =#{recipenum}
  	</select>
  	
  	<select id="GetRecipeContent" resultType="recipe.model.RecipeContentBean">
  		select * from recipe_content
  		where recipe_num=#{recipenum}
  		order by recipe_content_num asc
  	</select>
  	
  	<select id="GetFood" resultType="recipe.model.FoodBean">
  		select * from recipe_food
  		where recipe_num=#{recipenum}
  	</select>
  	
  	<select id="GetBookmarkById" resultType="int">
  		select recipe_num from bookmark
  		where id = #{id}
  	</select>
  	
  	<delete id="DeleteBookmark">
  		delete bookmark
  		where id=#{id} and recipe_num=#{tel}
  	</delete>
  	
  	<select id="GetReviewByRecipe" resultType="recipe.model.RecipeReviewBean">
  		select * from review
  		where recipe_num=#{recipenum}
  	</select>
  	
  	<insert id="InsertReview">
  		insert into review
  		values(recipe_re_seq.nextval,#{review},#{id},sysdate,#{recipenum}) 
  	</insert>
  	
  	<select id="GetBookmarkCount" resultType="int">
  		select count(*) from bookmark
  		where recipe_num=#{recipenum}
  	</select>
  	
  	<insert id="InsertBookMark">
  		insert into bookmark
  		values(bookmark_seq.nextval,#{id},#{recipenum})
  	</insert>
  	
  	<insert id="InsertReport">
  		insert into review_report
  		values(recipe_report_seq.nextval,#{reportcontent},#{reviewnum})
  	</insert>
  	
  	<select id="CheckBookMark" resultType="int">
  		select count(*) from bookmark
  		where id=#{id} and recipe_num=#{recipenum}
  	</select>
  	
  	<select id="GetingrecipeTotalCount" resultType="int">
  		select count(*) from recipe join recipe_food food on recipe.recipe_num = food.recipe_num
		where food_name like #{keyword}
  	</select>
  	<select id="GetAllRecipeByIngre" resultType="recipe.model.RecipeBean">
  		select recipe.recipe_num,recipe.recipe_name,recipe.recipe_category,recipe.servings,recipe.cook_image,recipe.readcount from recipe join recipe_food food on recipe.recipe_num = food.recipe_num 
		where food_name like #{keyword}
		order by recipe_num
  	</select>
  	<select id="GetFoodRecipeTotalCount" resultType="int">
  		select distinct count(*) from recipe_food where food_category=#{keyword}
  	</select>
  	<select id="GetAllRecipeByFoodCate" resultType="recipe.model.RecipeBean">
  		select recipe.recipe_num,recipe.recipe_name,recipe.recipe_category,recipe.servings,recipe.cook_image,recipe.readcount from recipe join recipe_food
		on recipe.recipe_num = recipe_food.recipe_num where food_category=#{keyword}
  	</select>
  	<update id="UpdateReadCount">
  		update recipe set readcount=readcount+1 where recipe_num=#{recipenum}
  	</update>
  	<select id="GetAllRecipeByReadCount" resultType="recipe.model.RecipeBean">
  		select * from recipe
  		order by readcount desc
  	</select>
  	<select id="GetAllRecipeByBookMark" resultType="recipe.model.RecipeBean">
  		select recipe.recipe_num,recipe.recipe_name,recipe.recipe_category,recipe.servings,recipe.cook_image,recipe.readcount,bookmarknum
		from recipe join (select recipe_num, count(*)as bookmarknum from bookmark group by recipe_num) mark on recipe.recipe_num = mark.recipe_num
		order by bookmarknum desc
  	</select>
  </mapper>